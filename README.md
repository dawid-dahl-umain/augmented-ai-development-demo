# AAID Acceptance Testing Demo

> **Companion to**: [AAID: Augmented AI Development](https://github.com/dawid-dahl-umain/augmented-ai-development)
>
> This repository demonstrates the acceptance testing patterns described in the main AAID methodology. While the article explains the theory, this repo provides working code you can run and study.
>
> **Four-layer acceptance testing model**: Based on the architecture pioneered by [Dave Farley](https://courses.cd.training/) in his work on Continuous Delivery and acceptance testing.

---

## Quick Start

```bash
git clone https://github.com/dawid-dahl-umain/augmented-ai-development-demo.git
cd augmented-ai-development-demo
pnpm install

# Run the demo game
pnpm start -- --moves 1,4,2,5,3

# Run acceptance tests (CLI suite)
pnpm test:at

# Run isolation demo (9 tests)
pnpm exec vitest run acceptance-test-isolation-demo/acceptance-test/

# Run all tests, including unit tests
pnpm test
```

---

## What This Demonstrates

### Four-Layer Acceptance Testing

-   Executable specifications that map to BDD scenarios
-   Domain-specific language for business-readable tests
-   Protocol driver that executes the real compiled CLI
-   System under test with hexagonal architecture

### Test Isolation Patterns\*\*

-   Parallel test execution without interference
-   Temporal isolation for re-runnable tests
-   `DslContext` and `Params` utilities with working examples

### Hexagonal Architecture

-   Pure domain logic (no I/O dependencies)
-   Clear adapter boundaries
-   Dependency inversion with ports

All code was generated by AI following the AAID workflow.

---

## Repository Structure

```text
aaid-demo/
├── acceptance-test/                    # Main acceptance test suite
│   ├── executable-specs/               # 15 BDD tests (maps 1:1 to specs)
│   ├── dsl/                            # Business vocabulary layer
│   │   └── utils/                      # Test isolation utilities (DslContext, Params)
│   ├── protocol-driver/                # Executes real CLI + validates output
│   └── sut/                            # Notes about system under test
│
├── acceptance-test-isolation-demo/     # Focused isolation examples
│   ├── executable-specs/               # 9 tests demonstrating isolation patterns
│   ├── dsl/                            # Simplified DSL for demo
│   ├── protocol-driver/                # Mock driver (in-memory)
│   └── sut/                            # Mock todo system
│
├── specification-package/              # Complete BDD scenarios (Given/When/Then)
│
├── src/                                # Hexagonal architecture (the SUT)
│   ├── domain/tic-tac-toe/             # Pure domain logic (immutable, I/O-free)
│   └── adapters/cli/                   # I/O boundaries
│       ├── input/                      # Driving adapters (CLI → domain)
│       ├── output/                     # Driven adapters (domain → text)
│       └── runner/                     # Composition + orchestration
│
└── ai-roadmaps/                        # Planning docs from AAID Stage 2
```

---

## Four-Layer Model Example

**BDD Specification** ([specification-package/](./specification-package/tictactoe-bdd-specification-package.md))

```gherkin
Scenario: Valid move on empty cell
  Given it is player X's turn
  And position 5 is empty
  When player X places their mark at position 5
  Then position 5 should contain X
  And it should be player O's turn
```

**Executable Test** ([acceptance-test/executable-specs/](./acceptance-test/executable-specs/cli.acceptance.spec.ts))

```typescript
it("should accept a valid move on an empty cell", async () => {
    // Given
    await dsl.game.start()
    await dsl.player.isTurn("X")
    dsl.board.isPositionEmpty(5)

    // When
    await dsl.player.placeMark("X", 5)

    // Then
    dsl.board.confirmPositionContains(5, "X")
    await dsl.player.confirmNextTurn("O")
})
```

**DSL Layer** ([acceptance-test/dsl/player.ts](./acceptance-test/dsl/player.ts))

```typescript
async placeMark(player: "X" | "O", position: number): Promise<void> {
    await this.driver.placeMark(position)
}
```

**Protocol Driver** ([acceptance-test/protocol-driver/cli-driver.ts](./acceptance-test/protocol-driver/cli-driver.ts))

```typescript
public async placeMark(position: number): Promise<void> {
    const nextHistory = [...this.moveHistory, String(position)]
    await this.executeMoves(nextHistory)
}
```

The test runs the actual compiled CLI and validates real output—no mocks.

---

## Architecture

The demo uses an extremely minimal implementation hexagonal architecture with clear separation between domain and adapters:

```text
src/
├── domain/tic-tac-toe/        # Pure logic (no I/O, UI-agnostic)
│   ├── game.ts                # Immutable state, pure functions
│   └── ports.ts               # Presenter interface (dependency inversion)
│
└── adapters/cli/              # I/O boundaries
    ├── input/                 # CLI commands → domain
    ├── output/                # Domain → text (implements Presenter)
    └── runner/                # Composition root
```

Domain has zero I/O dependencies. All side effects happen in adapters. This makes the domain easily testable and the system flexible (swap CLI for web UI without touching domain logic).

---

## Test Isolation

Acceptance tests run slower than unit tests since they execute the full system. We run them in parallel to maintain speed. The `DslContext` and `Params` utilities prevent test interference.

**Problem:**

```typescript
// Test A: Creates "user@test.com", adds "Buy milk"
// Test B: Creates "user@test.com", adds "Buy milk"  ← Collision
```

**Solution:**

```typescript
// Test A: params.alias("email") → "user@test.com1"
// Test B: params.alias("email") → "user@test.com2"  ← Isolated
```

**Three patterns:**

1. **Functional isolation** - Unique data per test

    ```typescript
    const email = params.alias("email") // user1@test.com, user2@test.com, ...
    ```

2. **Temporal isolation** - Re-runnable without cleanup

    ```typescript
    const title = params.alias("title") // "Buy milk1", "Buy milk2", ...
    ```

3. **Readability helpers** - Optional defaults

    ```typescript
    const desc = params.optional("description", "")
    ```

See [`acceptance-test-isolation-demo/`](./acceptance-test-isolation-demo/) for working examples.

Full documentation: [`acceptance-test/dsl/utils/README.md`](./acceptance-test/dsl/utils/README.md)

---

## CLI Usage

The TicTacToe CLI is fully functional if you want to explore it:

```bash
# Run with moves
pnpm start -- --moves 1,4,2,5,3

# Quiet mode
pnpm start -- --moves 1,4,2,5,3 --no-verbose
```

**Example:**

```text
Round 0
X to move

  1 | 2 | 3
 ---+---+---
  4 | 5 | 6
 ---+---+---
  7 | 8 | 9

...

Player X wins!
```

**Error handling:**

-   Non-numeric input: `Invalid input: enter a number 1-9`
-   Out of range: `Invalid position: choose 1-9`
-   Position taken: `Position already taken at N`

**Exit codes:**

-   `0` - Normal termination
-   `2` - Invalid input
-   `3` - Invalid position
-   `4` - Position taken

---

## Scripts

```bash
pnpm build          # Compile TypeScript
pnpm start          # Run CLI (builds automatically)
pnpm test           # Run tests
pnpm test:watch     # Run tests in watch mode
pnpm coverage       # Run tests with coverage
pnpm lint           # Check code style
pnpm lint:fix       # Fix style issues
pnpm check          # Lint + test
```

---

## Resources

**In This Repository:**

-   [`acceptance-test/`](./acceptance-test/) - Four-layer implementation
-   [`acceptance-test-isolation-demo/`](./acceptance-test-isolation-demo/) - Isolation utility examples
-   [`specification-package/`](./specification-package/) - BDD scenarios
-   [`ai-roadmaps/`](./ai-roadmaps/) - Planning documents

**External:**

-   [AAID Methodology](https://github.com/dawid-dahl-umain/augmented-ai-development) - Complete guide
-   [AAID Acceptance Testing Guide](https://github.com/dawid-dahl-umain/augmented-ai-development/blob/main/appendices/appendix-a/docs/aaid-acceptance-testing-workflow.md) - Detailed workflow
-   [Dave Farley's Four-Layer Model](https://dojoconsortium.org/assets/ATDD%20-%20How%20to%20Guide.pdf) - Original pattern

---

## License

MIT
